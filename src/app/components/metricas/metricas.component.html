<app-header></app-header>

<!--Contenedor Contenido Pagina-->
<div class="mb-5 container py-3">

    <!-- Metricas -->
    <div class="container m-auto pb-2 bg-success rounded-top">
        <h1 style="cursor:context-menu" class="mt-5 pt-4 text-center">Metricas</h1>
    </div>
    <!--Contenedor busqueda-->
    <div class="container pt-1 bg-secondary rounded-bottom">
        <div>
            <div class="contenedor py-3">
                <form>
                    <div class="tab-pane fade show active" id="nav-Pregunta1ACT" role="tabpanel"
                        aria-labelledby="nav-Pregunta1ACT-tab">
                        <div class="form-group">
                            <h4 style="cursor:context-menu" class="pb-1 pt-3 mb-3 text-white font-weight-bold">
                                Buscar Actividades</h4>
                            <!--Buscar Actividad-->
                            <div>
                                <form #frmBuscarActividad="ngForm" (ngSubmit)="saveDataActividad(frmBuscarActvidad)">
                                    <div class="form-row">

                                        <div class="col-sm-6">

                                            <label for="inputTextoBusquedaActividad" class="text-white">Buscador
                                                Actividad</label>
                                            <input type="text" class="form-control" id="inputTextoBusquedaActividad"
                                                placeholder="Busqueda por nombre de la Actividad"
                                                [(ngModel)]="nombreActividadSelected" name="nombreActividadSelected">

                                        </div>
                                        <div class="col-sm-3">
                                            <label for="inputMateriaA" class="text-white">Materia</label>
                                            <select [(ngModel)]="materiaSelectedA" id="inputMateriaA" name="materiaA"
                                                class="form-control" ngModel required>
                                                <option selected></option>
                                                <option *ngFor="let mater of materias" [value]="mater.id_materia">
                                                    {{mater.nombre_materia}}</option>
                                            </select>
                                        </div>
                                        <div class="col-sm-3">
                                            <label for="inputGradoA" class="text-white">Grado</label>
                                            <select [(ngModel)]="gradoSelectedA" id="inputGradoA" name="gradoA"
                                                class="form-control" ngModel required>
                                                <option selected></option>
                                                <option *ngFor="let grad of grados" [value]="grad.id_grado">
                                                    {{grad.nombre_grado}}
                                                </option>
                                            </select>
                                        </div>

                                    </div>
                                    <div class="form-row mt-3">
                                        <div class="col-sm-6">
                                            <label for="inputDocenteA" class="text-white">Buscador Competencia</label>
                                            <input type="text" class="form-control" id="inputTextoBusquedaCompetencia"
                                                placeholder="Ingrese palabra clave"
                                                [(ngModel)]="nombreCompetenciaSelected" name="inputBusquedaCompetencia">
                                        </div>
                                        <div class="col-sm-6">
                                            <label for="inputDocenteA" class="text-white">Competencia</label>
                                            <select [(ngModel)]="competenciaSelectedA" id="inputCompetenciaA"
                                                name="competenciaA" class="form-control"
                                                onfocus='if(this.options.length > 2){ this.size = 8; }'
                                                onblur='this.size=1;' onchange='this.size=1; this.blur();' ngModel
                                                required>
                                                <option class="col-auto px-0" selected></option>
                                                <option class="col-auto px-0" selected [value]=0>Sin Competencia
                                                </option>
                                                <option class="col-auto px-0"
                                                    *ngFor="let compe of competencias | filterCompetencia: nombreCompetenciaSelected:materiaSelectedA:gradoSelectedA"
                                                    [value]="compe.id_competencia">{{(compe.nombre_competencia)}}
                                                </option>
                                            </select>
                                        </div>

                                    </div>
                                </form>
                                <div class="contenedor py-3">
                                    <form #frmBuscarActividad="ngForm"
                                        (ngSubmit)="saveDataActividad(frmBuscarActvidad)">

                                        <!--Tabla de Resultados-->
                                        <label for="inputState" class="text-white">Resultados:</label>
                                        <div class="col container p-4 my bg-light rounded table-wrapper-scroll-y my-custom-scrollbar"
                                            style="width: 95%; height: 450px">
                                            <!--Resultado-->
                                            <div class="row-1"
                                                *ngFor="let actividad of actividadVisualizar | filterActividad: nombreActividadSelected:materiaSelectedA:gradoSelectedA:id_docenteAuth:competenciaSelectedA">
                                                <div class="card mb-4 border-0" style="max-width: 1440px;">
                                                    <div class="card-footer p-2 bg-warning rounded-top">
                                                        <h5 class="card-title m-1">{{actividad.titulo_actividad}}</h5>
                                                    </div>
                                                    <div class="row no-gutters border border-top-0 border-secondary">
                                                        <div class="col" style="max-width: 840px;">
                                                            <div class="card-body p-2">
                                                                <p class="card-text ">Descripcion:
                                                                    {{actividad.descripcion_actividad}}.</p>
                                                                <div>
                                                                    <p class="card-text"><small
                                                                            class="text-muted">Materia:
                                                                            {{actividad.materia}}</small></p>
                                                                </div>
                                                                <div>
                                                                    <p class="card-text"><small
                                                                            class="text-muted">Grado:
                                                                            {{actividad.id_grado}}</small></p>
                                                                </div>
                                                                <div>
                                                                    <p class="card-text"><small
                                                                            class="text-muted">Competencia:
                                                                            {{actividad.competencia}}</small></p>
                                                                </div>
                                                                <div>
                                                                    <p class="card-text"><small
                                                                            class="text-muted">Profesor:
                                                                            {{actividad.docente}}</small></p>
                                                                </div>

                                                            </div>
                                                        </div>
                                                    </div>
                                                    <!--Boton ver Metricas Actividad-->
                                                    <div
                                                        class="card-footer bg-secondary row justify-content-md-center no-gutters p-1">
                                                        <a class="btn bg-success font-weight-bold" data-toggle="modal"
                                                            data-target="#mimodalejemplo"
                                                            (click)="getActividadinModal(actividad)">Ver Metricas</a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        <hr class="style10">
        <br>
    </div>

    <!-- Modal Actividad Seleccionada -->
    <div class="modal fade col" id="mimodalejemplo" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
        style="overflow-y: scroll;">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content ">



                <div class="modal-header bg-warning">
                    <h4 class="modal-title text-center my-0" id="myModalLabel">
                        {{ActividadService.selectedActividad.titulo_actividad}}</h4>
                    <button type="button" class="close " data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body bg-light">
                    <div class="card">
                        <div class="card-body">
                            <div class="">
                                <div class="container">
                                    <div class="row">
                                        <div class="col-sm-6 text-center">
                                            <h5>Total de estudiantes</h5>
                                            <img src="assets/img/iconrobot.png" class="rounded-circle">
                                            <h6>{{metricasActividad.inicio}}</h6>

                                        </div>

                                        <div class="col-sm-6">

                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- En esta parte van las metricas del video esta comentado porque no se implemnta en esta version -->
                        <div>
                            <h5 style="cursor:context-menu" class="">Metricas Video:</h5>
                        </div>
                        <hr class="style10">
                        <div class="row-1">
                            <div class="card mb-4 border-0" style="max-width: 1440px;">
                                <div class="row no-gutters ">
                                    <div class="col" style="max-width: 840px;">
                                        <div class="card-body p-2 text-metricas">
                                            <div>
                                                <a class="card-text"><small class="text-muted">Contenido: </small></a>



                                            <div class="row-1">
                                                <div class="mb-4 border-0" style="max-width: 1440px;">
                                                    <div class="row no-gutters">
                                                        <div class="col-md-10" style="max-width: 840px;">
                                                            <div class="p-2">

                                                                <div>
                                                                    <p class="card-text"><small
                                                                            class="text-muted">Grado:
                                                                            {{ActividadService.selectedActividad.id_grado}}</small>
                                                                    </p>
                                                                </div>
                                                                <div>
                                                                    <p class="card-text"><small
                                                                            class="text-muted">Materia:
                                                                            {{ActividadService.selectedActividad.materia}}</small>
                                                                    </p>
                                                                </div>
                                                                <div>
                                                                    <p class="card-text"><small
                                                                            class="text-muted">Profesor:
                                                                            {{ActividadService.selectedActividad.docente}}</small>
                                                                    </p>
                                                                </div>

                                                                <div>
                                                                    <p class="card-text"><small
                                                                            class="text-muted">Competencia:
                                                                            {{ActividadService.selectedActividad.competencia}}</small>
                                                                    </p>
                                                                </div>

                                                                <div>
                                                                    <p class="card-text">
                                                                        <small class="text-muted">Descripción:
                                                                            {{ActividadService.selectedActividad.descripcion_actividad}}</small>
                                                                    </p>
                                                                </div>
                                                            </div>
                                                            <div class="text-center"><button type="button"
                                                                    class="btn btn-default bg-danger font-weight-bold text-white "
                                                                    data-dismiss="modal" data-toggle="modal"
                                                                    data-target="#mimodalejemplo3">Reiniciar
                                                                    Actividad</button></div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                                <!--Metricas Globales Actividad-->

                            </div>
                        </div>
                    </div>
                    <div class="card mt-3">
                        <div class="card-body">
                            <div>
                                <h5 style="cursor:context-menu">Metri
                                    
                                    cas Actividad Grupales</h5>
                            </div>
                            <div class="row-1">
                                <div class="mb-4 border-0" style="max-width: 1440px;">
                                    <div class="row no-gutters ">
                                        <div class="col" style="max-width: 840px;">
                                            <div class="card-body p-2">
                                                <h6 class="text-center">Acciones de Actividad</h6>
                                                <div style="display: block; height: 300px; width: 300px;">
                                                    <canvas baseChart width="200" height="200"
                                                        [datasets]="actionChartData" [labels]="actionChartLabels"
                                                        [options]="actionChartOptions" [colors]="actionChartColors"
                                                        [legend]="lineChartLegend" [chartType]="notasChartType"
                                                        [plugins]="lineChartPlugins">
                                                    </canvas>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col my-auto" style="max-width: 840px;">
                                            <div class="card-body p-2">
                                                <h6 class="text-center">Promedio de Notas</h6>
                                                <div style="display: block; height: 300px; width: 300px;">
                                                    <canvas baseChart width="200" height="200"
                                                        [datasets]="notasChartData" [labels]="notasChartLabels"
                                                        [options]="notasChartOptions" [colors]="lineChartColors"
                                                        [legend]="lineChartLegend" [chartType]="notasChartType"
                                                        [plugins]="lineChartPlugins">
                                                    </canvas>

                                    <div class="col my-auto" style="max-width: 860px;">
                                        <div class="card-body p-2">
                                            <div *ngFor=" let review of reviews">
                                                <div class="row">
                                                    <div class="col-sm">
                                                        <a class="card-text">
                                                            <app-calificacion [calificacion]="review.rating">
                                                            </app-calificacion>
                                                        </a>
                                                    </div>
                                                    <div class="col-sm">
                                                        <span
                                                            style="margin-left: 3px; font-weight: bold;">{{review.rating}}</span>
                                                    </div>

                                                </div>

                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <hr class="style10">
                            <app-comentarios [comments]="comments" ></app-comentarios>
                        </div>
                        <hr class="style10">
                        <!--Buscar Esdtudiante-->
                        <label class="pt-2">Buscador:</label>
                        <div class="form-group">
                            <input type="text" class="form-control col-md-8" id="inputTextoBusquedaEstudiante"
                                placeholder="Nombre / Apellido" [(ngModel)]="palabraClaveESelected"
                                name="palabraClaveESelected">
                        </div>
                        <div class="form-group col-4">
                            <label for="inputOption" class="">Estudiantes que:</label>
                            <select [(ngModel)]="optionSelected" id="inputOption" name="optionSelected"
                                class="form-control" ngModel required>
                                <option selected></option>
                                <option *ngFor="let option of options" style="overflow-y: scroll;"
                                    [value]="option.valor">{{option.opcion}}</option>
                            </select>
                        </div>




                        </div>
                    </div>
                    <div class="card mt-3">
                        <div class="card-body">
                            <!--Buscar Esdtudiante-->
                            <h5 class="pt-2 ">Metricas de Actividades Individuales</h5>
                            <div class="form-row">
                                <div class="col-sm-8">
                                    <label for="inputTextoBusquedaEstudiante" class="">Buscar Estudiante:</label>
                                    <input type="text" class="form-control" id="inputTextoBusquedaEstudiante"
                                        placeholder="Nombre / Apellido" [(ngModel)]="palabraClaveESelected"
                                        name="palabraClaveESelected">
                                </div>
                                <div class="col-sm-4">
                                    <label for="inputOption" class="">Estudiantes que:</label>
                                    <select [(ngModel)]="optionSelected" id="inputOption" name="optionSelected"
                                        class="form-control" ngModel required>
                                        <option selected></option>
                                        <option *ngFor="let option of options" style="overflow-y: scroll;"
                                            [value]="option.valor">{{option.opcion}}</option>
                                    </select>
                                </div>
                            </div>


                            <!--Resultado Estudiantes-->
                            <div class="pt-4 row mx-auto">
                                <table
                                    class="mx-auto text-white table-striped table-wrapper-scroll-y my-custom-scrollbar"
                                    style="height: 256px;">
                                    <thead class="bg-dark ">
                                        <th class="pl-3 pr-5 py-2 text-white">Nombre Estudiante</th>
                                        <th class="pl-4 pr-4 py-2 text-white text-center">Acción</th>
                                    </thead>
                                    <tbody class="bg-light">
                                        <tr mdbTableCol
                                            *ngFor="let metrica of metricasVisualizar | filterEstudianteMetricas: palabraClaveESelected:optionSelected">
                                            <td class="pl-3 pr-5 py-2 text-dark">{{ metrica.estudiante }}</td>
                                            <td class="pl-4 pr-4 py-2">
                                                <a class="btn bg-warning py-0 px-1 text-dark font-weight-bold"
                                                    data-toggle="modal" data-target="#mimodalejemplo2"
                                                    (click)="getAvanceEstudianteModal(metrica)">ver Metricas</a>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                    </div>
                    <div class="card mt-3">
                        <div class="card-body">
                            <!--Boton cerrar modal-->
                            <div class="row pt-3 justify-content-md-center no-gutters bg-light">
                                <button type="button" class="btn btn-default bg-warning font-weight-bold ml-3"
                                    data-dismiss="modal">Cerrar</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Metricas Estudiante -->
    <div class="modal fade" id="mimodalejemplo2" tabindex="-1" role="dialog" aria-labelledby="myModalLabel2">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header bg-warning">
                    <h3 class="modal-title" id="myModalLabel">Metricas Estudiante</h3>
                    <button class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body bg-light">
                    <!--Metricas Individuales Actividad-->
                    <div class="pb-2">
                        <h3 style="cursor:context-menu" class="font-weight-bolder  text-center">{{
                            metricaVisualizarToSave.estudiante }}
                        </h3>
                    </div>
                    <div class="container">
                        <h5 class="">Acciones</h5>
                        <div class="row " >
                            <div class="col-sm-4" *ngFor="let card of cards" >
                                <div class="card bg-success text-dark mt-3" [ngClass]="card.color">
                                    <div class="card-body inline" style="padding: 8px !important;">
                                        <h5 class="text-center ">{{ card.titulo }}</h5>
                                        <p class="card-text text-center">{{ card.descripcion }}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- <div class="container">
                        <h5 class="mt-3">Acciones</h5>
                        <div class="row">
                            <div class="col-sm-4" *ngFor="let card of cards">
                                <div class="card bg-success text-dark mt-3" [ngClass]="card.color">
                                    <fa-icon [icon]="faCoffee" size="7x" class="card-img" alt="Card image"
                                        style="color: white; opacity: 0.5; "></fa-icon>
                                    <div class="card-body">
                                        <div class="card-img-overlay">
                                            <h5 class="card-title text-center">{{ card.titulo }}</h5>
                                            <p class="card-text text-center font-weight-bold">{{ card.descripcion }}</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div> -->

                    <div class="container mt-3">
                        <div class="row">
                            <div class="col-sm-6">
                                <circle-progress [percent]="porcentajenuevo" [radius]="85" [outerStrokeWidth]="20"
                                    [innerStrokeWidth]="0" [outerStrokeColor]="'#78C000'" [innerStrokeColor]="'#239B56'"
                                    [unitsFontSize]="42" [animation]="true" [titleFontSize]="35" [titleFontWeight]="700"
                                    [subtitle]="'Progreso Estudiante'" [subtitleFontWeight]="500"
                                    [subtitleFontSize]="15" [responsive]="true"
                                    [animationDuration]="1000"></circle-progress>
                            </div>
                            <div class="col-sm-6">
                                <h6 class="text-center">Notas</h6>
                                <div style="display: block; ">
                                    <canvas baseChart width="300" height="300" [datasets]="notasEstudiantesChartData"
                                        [labels]="notasEstudiantesChartLabels" [options]="notasChartOptions"
                                        [colors]="lineChartColors" [legend]="lineChartLegend"
                                        [chartType]="notasChartType" [plugins]="lineChartPlugins">
                                    </canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!--Modal Confirmar Reiniciar Actividad -->
    <div class="modal fade" id="mimodalejemplo3" tabindex="-1" role="dialog" aria-labelledby="myModalLabel3">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header bg-light">
                    <h5 class="modal-title" id="myModalLabel">¿Desea reiniciar la actividad?</h5>
                    <button class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    Recuerde, una vez que se reinicie la actividad los datos de sus estudiantes
                    se eliminan definitivamente.
                    Presione <b>Aceptar</b> si desea continuar, de lo contrario presione <b>X</b> para cancelar.
                </div>
                <div class="modal-footer justify-content-md-center no-gutters bg-light py-1">
                    <button class="btn btn-default bg-warning font-weight-bold" data-dismiss="modal"
                        (click)="reiniciarActividad()">Aceptar</button>
                </div>
            </div>
        </div>
    </div>
</div>